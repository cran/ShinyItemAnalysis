---
title: |
  <b>Item Analysis Report</b>
  
  **************

date: '`r Sys.Date()`'
output:
    html_document:
       number_sections: false
       toc: true
author: |
    <h4>This report was generated by ShinyItemAnalysis application version `r packageVersion("ShinyItemAnalysis")`.</h4>
   
    <h4>Copyright 2017 Patricia Martinkova, Adela Drabinova, Ondrej Leder and Jakub Houdek.</h4>
   
    <h4>Supported by Czech Science Foundation under grant number [GJ15-15856Y](http://www.cs.cas.cz/martinkova/psychometrics.html).</h4>
params:
  a: NA
  k: NA
  gr: NA
  results: NA
  histogram_totalscores: NA
  corr_plot: NA
  scree_plot: NA
  difPlot: NA
  hist_distractor_by_group: NA
  graf: NA
  logreg: NA
  zlogreg: NA
  zlogreg_irt: NA
  nlsplot: NA
  multiplot: NA
  wrightMap: NA
  irt: NA
  irtiic: NA
  irttif: NA
  irtcoef: NA
  irtfactor: NA
  resultsgroup: NA
  histbyscoregroup0: NA
  histbyscoregroup1: NA
  deltaplot: NA
  DP_text_normal: NA
  DIF_logistic_print: NA
  DIF_logistic_plot: NA
  plot_DIF_logistic: NA
  plot_DIF_logistic_IRT_Z: NA
  plot_DIF_NLR: NA
  plot_DIF_IRT_Lord: NA
  plot_DIF_IRT_Raju: NA
  itemexam: NA
  itemReport: NA
  irt_type: NA
  model_DDF_print: NA
  plot_DDFReportInput: NA
  isGroupPresent: NA
  histCheck: NA
  deltaplotCheck: NA
  logregCheck: NA
  multiCheck: NA
  groupie: NA
---

**************

\pagebreak

# Summary report

## Summary of total scores

**Summary table of total scores**
```{r total-scores-table, echo = FALSE}
library(knitr)
table = params$results
colnames(table) = NULL

kable(t(table), digits = c(0, 0, 3, 0, 3, 3, 3), align = 'c')
```

```{r total-scores-histogram, echo = FALSE,  fig.height = 4, fig.align = 'center'}
params$histogram_totalscores + ggtitle('Histogram of total scores') + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
```

`r if (any(params$corr_plot != "")) {"## Correlation structure"}`

```{r corr-plot, echo = FALSE, fig.height = 4, fig.align = 'center'}
if (any(params$corr_plot != "")) {
  corrplot(params$corr_plot, tl.cex = 0.7)
}
```

```{r scree-plot, echo = FALSE, fig.height = 4, fig.align = 'center'}
if (any(params$corr_plot != "")) {
  params$scree_plot + ggtitle("Scree plot") + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
}
```

\pagebreak

**************

# Traditional item analysis report

## Item analysis

```{r DD-plot, echo = FALSE, fig.height = 4, fig.align = 'center'}
params$difPlot + ggtitle('Difficulty/Discrimination plot') + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
```

**Traditional item analysis table**
```{r item-table, echo = FALSE}
table = params$itemexam
tab = format(round(table[, -1], 4), nsmall = 3)
table = data.frame(table[, 1], tab)
colnames(table) = c("Item", "Diff.", "SD", "D. ULI", "D. RIT", "D. RIR", "Alpha Drop")
rownames(table) = NULL

kable(table, digits = c(0, 4, 4, 4, 4, 4, 4), align = 'c')
```

## Distractor analysis

```{r distractor-multi-plot, echo = FALSE, fig.width = 10, fig.align = 'center'}
library(gridExtra)
for (i in 1:length(params$graf)){
  grid.arrange(params$graf[[i]], params$multiplot[[i]], ncol = 2)
}
```

\pagebreak

**************

# IRT model

```{r irt-eq, echo = FALSE, results = "hide"}
if (params$irt_type == "rasch") {
  head = " Rasch model"
}

if (params$irt_type == "1pl") {
head = " 1PL IRT model"
eq = "$ {P}(Y_{ij} = 1|\theta_{i},a,b_j) =\frac{e^{a(\theta_i-b_j)}}{1+e^{a(\theta_i-b_j)}} $"
}

if (params$irt_type == "2pl") {
head = " 2PL IRT model"
eq = "$$ {P}(Y_{ij} = 1|\theta_{i},a_j,b_j) = \frac{e^{a_j(\theta_i-b_j)}}{1+e^{a_j(\theta_i-b_j)}}$$"
}

if (params$irt_type == "3pl") {
head = " 3PL IRT model"
#eq = "$$ {P}(Y_{ij} = 1|\theta_{i},a_j,b_j, c_j) = c_j + (1+c_j)\cdot\frac{e^{a_j(\theta_i-b_j)}}{1+e^{a_j(\theta_i-b_j)}}$$"
}

if (params$irt_type == "none") {
head = " None"
}
```

Available models:

Rasch model
$$ {P}(Y_{ij} = 1|\theta_{i},b_j) =\frac{e^{(\theta_i-b_j)}}{1+e^{(\theta_i-b_j)}} $$

1PL IRT model
$$ {P}(Y_{ij} = 1|\theta_{i},a,b_j) =\frac{e^{a(\theta_i-b_j)}}{1+e^{a(\theta_i-b_j)}}$$

2PL IRT model
$$ {P}(Y_{ij} = 1|\theta_{i},a_j,b_j) = \frac{e^{a_j(\theta_i-b_j)}}{1+e^{a_j(\theta_i-b_j)}}$$

3PL IRT model
$$ {P}(Y_{ij} = 1|\theta_{i},a_j,b_j, c_j) =c_j + (1+c_j)\cdot\frac{e^{a_j(\theta_i-b_j)}}{1+e^{a_j(\theta_i-b_j)}}$$

**`r if (any(params$wrightMap!="")) {"Wright (item-person) map using 1PL IRT model"}`**
```{r wright-map, echo = FALSE, results = "hide", fig.height = 6, fig.width = 10, fig.align = 'center'}
if (any(params$wrightMap != "")) {
  wrightMap(params$wrightMap[[1]], params$wrightMap[[2]], item.side = itemClassic)
}
```

`r if (any(params$wrightMap!="")) {"\\pagebreak"}`

**Selected model:`r head`**

```{r irt-0, echo = FALSE, results = "hide", fig.height = 4}
if (params$irt_type != "none") {
  params$irt
}
```

```{r irt-1, echo = FALSE, results = "hide", fig.height = 4}
if (params$irt_type != "none") {
  params$irtiic
}
```

```{r irt-2, echo = FALSE, fig.height = 4}
if (params$irt_type != "none") {
  params$irttif
}
```

`r if (any(params$wrightMap!="")) {"\\pagebreak"}`

**`r if (params$irt_type != "none") {"Parameter estimates and item fit"}`**
```{r irt-estim, echo = FALSE}
if (params$irt_type != "none") {
  table = params$irtcoef
  table = round(table, 5)
  
  kable(table, align = 'c')
}
```

**`r if (params$irt_type != "none") {"Ability estimates"}`**

```{r irt-3, echo = FALSE, fig.height = 4}
if (params$irt_type != "none") {
  params$irtfactor + ggtitle('Scatterplot of factor scores and standardized total scores') + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
}
```

`r if (any(c(params$histCheck, params$deltaplotCheck, params$logregCheck, params$multiCheck)) & params$isGroupPresent) {"**************"}`


`r if(any(c(params$histCheck, params$deltaplotCheck, params$logregCheck, params$multiCheck))) {"# DIF/Fairness report"}`

`r if(any(c(params$histCheck, params$deltaplotCheck, params$logregCheck, params$multiCheck)) & !params$isGroupPresent){"Group vector is not present. DIF and DDF Report could not be generated!"}`

`r if(params$isGroupPresent & params$histCheck) {"## Total scores"}`

`r if(params$isGroupPresent & params$histCheck) {"**Summary table of total scores in reference and focal group**"}`

```{r table-by-group, echo = FALSE}
if (params$histCheck) {
  if(params$isGroupPresent){
    kable(params$resultsgroup, digits = c(0, 0, 3, 0, 3, 3, 3), align = 'c')
  }
}
```


```{r hist-by-group, echo = FALSE, fig.height = 8, fig.align = 'center'}
if (params$histCheck) {
  if(params$isGroupPresent){
    g1 = params$histbyscoregroup0 + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
    g2 = params$histbyscoregroup1 + theme(text = element_text(size = 10), plot.title = element_text(face = "bold"))
    grid.arrange(g1, g2, ncol = 1)
  }
}
```

`r if(params$isGroupPresent & params$deltaplotCheck) {"## DIF detection using Delta plot"}`


```{r delta-plot-output, echo = FALSE}
if (params$deltaplotCheck) {
  if(params$isGroupPresent){
    params$DP_text_normal
  }
}
```


```{r delta-plot, echo = FALSE, results = "hide", fig.height = 4, fig.align = 'center'}
if (params$deltaplotCheck) {
  if(params$isGroupPresent){
    print(params$deltaplot +
            geom_text(size = 0.1) +
            theme(text = element_text(size = 10), plot.title = element_text(face = "bold")))
  }
}
```

`r if(params$isGroupPresent & params$logregCheck) {"## DIF detection using logistic regression"}`
```{r dif-logistic-output, echo = FALSE}
if (params$logregCheck) {
 if(params$isGroupPresent){
  params$DIF_logistic_print
  } 
}
```


```{r dif-logistic-plot, echo = FALSE, results = 'hide', fig.height = 4, fig.align = 'center'}
if (params$logregCheck) {
  if(params$isGroupPresent){
    params$DIF_logistic_plot
  }
}
```

`r if(params$isGroupPresent & params$multiCheck) {"## DDF detection Using multinomial regression"}`
```{r ddf-multi-output, echo = FALSE}
if (params$multiCheck) {
  if(params$isGroupPresent){
    print(params$model_DDF_print) 
  }
}
```


```{r ddf-multi-plot, echo = FALSE, results = 'hide', fig.height = 4, fig.align = 'center'}
if (params$multiCheck) {
  if(params$isGroupPresent){
    params$plot_DDFReportInput
  }
}
```

\pagebreak

**************

# Session info

```{r session-info, echo = FALSE}
sessionInfo()
```

\pagebreak
